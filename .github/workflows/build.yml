name: Build

on:
  workflow_dispatch:

jobs:
  windows-installer-build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build Windows installer
      run: |
        cd app
        npm run electron:build:win:installer
    
    - name: List artifacts
      run: |
        cd app
        dir dist
    
    - name: Upload Windows installer artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows-installer-builds
        path: app/dist/*Windows-Installer*.exe
        if-no-files-found: warn

  windows-portable-build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build Windows portable
      run: |
        cd app
        npm run electron:build:win:portable
    
    - name: List artifacts
      run: |
        cd app
        dir dist
    
    - name: Upload Windows portable artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows-portable-builds
        path: app/dist/*Windows-Portable*.exe
        if-no-files-found: warn

  macos-x64-build:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build macOS x64 app
      run: |
        cd app
        npm run electron:build:mac
    
    - name: List artifacts
      run: |
        cd app
        ls -l dist
    
    - name: Upload macOS x64 artifacts
      uses: actions/upload-artifact@v4
      with:
        name: macos-x64-builds
        path: app/dist/*macOS*.dmg
        if-no-files-found: warn

  macos-arm64-build:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build macOS ARM64 app
      run: |
        cd app
        npm run electron:build:mac:arm64
    
    - name: List artifacts
      run: |
        cd app
        ls -l dist
    
    - name: Upload macOS ARM64 artifacts
      uses: actions/upload-artifact@v4
      with:
        name: macos-arm64-builds
        path: app/dist/*macOS*.dmg
        if-no-files-found: warn

  linux-x64-build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build Linux x64 app
      run: |
        cd app
        npm run electron:build:linux
    
    - name: List artifacts
      run: |
        cd app
        ls -l dist
    
    - name: Upload Linux x64 artifacts
      uses: actions/upload-artifact@v4
      with:
        name: linux-x64-builds
        path: |
          app/dist/*Linux*.AppImage
          app/dist/*Linux*.deb
          app/dist/*Linux*.rpm
        if-no-files-found: warn

  linux-arm64-build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build Linux ARM64 app
      run: |
        cd app
        npm run electron:build:linux:arm64
    
    - name: List artifacts
      run: |
        cd app
        ls -l dist
    
    - name: Upload Linux ARM64 artifacts
      uses: actions/upload-artifact@v4
      with:
        name: linux-arm64-builds
        path: |
          app/dist/*Linux*.AppImage
          app/dist/*Linux*.deb
          app/dist/*Linux*.rpm
        if-no-files-found: warn

  linux-armv7l-build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        
    - name: Install dependencies
      run: |
        cd app
        npm install
    
    - name: Build Linux ARMv7l app
      run: |
        cd app
        npm run electron:build:linux:armv7l
    
    - name: List artifacts
      run: |
        cd app
        ls -l dist
    
    - name: Upload Linux ARMv7l artifacts
      uses: actions/upload-artifact@v4
      with:
        name: linux-armv7l-builds
        path: |
          app/dist/*Linux*.AppImage
          app/dist/*Linux*.deb
          app/dist/*Linux*.rpm
        if-no-files-found: warn